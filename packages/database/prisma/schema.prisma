generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum TxType {
  RECEIVE
  WITHDRAW
}

model Transaction {
  id                String   @id @default(cuid())
  type              TxType
  isActive          Boolean  @default(true)
  authorizedAddress String   // the owner/controller
  address           String   // the (stealth) receiving/withdrawing address
  ephemeralPublicKey String?  // only for RECEIVE
  amountWei         Decimal  @db.Decimal(78, 0) // 256-bit safe
  txHash            String
  message           String?
  chain             String
  createdAt         DateTime @default(now())

  @@unique([chain, txHash]) // de-dup per chain
  @@index([authorizedAddress, createdAt(sort: Desc)])
  @@index([authorizedAddress, isActive, createdAt(sort: Desc)])
  @@index([authorizedAddress, address, isActive])
}
